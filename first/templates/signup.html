{%load static%}
{% block body %}
<!DOCTYPE html>
<html lang="UTF-8">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>註冊</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/signup.css' %}"/>
</head>
<body>
  <div class="section-login">
      <div class="banner">
          <img src="{% static 'images/LOGO.png' %}">
      </div>

  <div class="wrap">
    {% comment %} 如果只是要跳轉頁面用method="GET",其他都用method="POST"  {% endcomment %}
    <form action="{% url 'signup' %}" method="POST">
      {% csrf_token %}
      <div>
        <style>h1{
          font-size: 28px; 
          color:#838282; 
          text-align: center;}
        </style>
        <h1>不要心灰意code</h1>
      </div>

      <div>
        <input class="form-item" type="text" name="username" id="username" placeholder="使用者帳號">
        <div class="username-message" id="username-message"></div>
      </div>

      <div>
        <input class="form-item" type="text" name="email" id="email" placeholder="電子郵件">
        <div class="message" id="email-message"></div>
      </div> 

      <div>
        <input class="form-item" type="password" name="password1" id="password1" placeholder="密碼">
        <div class="message" id="password-message"></div>
      </div>

      <div>
        <input class="form-item" type="password" name="password2" id="password2" placeholder="再次確認密碼">
        <div class="message" id="password-message"></div>
      </div> 

      <button class="form-item button" type="submit">註冊</button>

      <div class="text-item">
        <span>已經有帳號了嗎？&ensp;</span>
        <a class="text-strong" href="/login">登入</a>
      </div>

      <div id="message" class="message"></div>

    </form>
  
   
    <script>
      var form = document.querySelector('form');
      form.addEventListener('submit', function(event) {
        var username = document.querySelector('#username').value;
        var email = document.querySelector('#email').value;
        var password1 = document.querySelector('#password1').value;
        var password2 = document.querySelector('#password2').value;

        var isValid = true;
        var errorMessage = '';

        if (!username.trim()) {
          errorMessage += '請輸入使用者帳號\n';
          isValid = false;
        }

        if (!email.trim() || !isValidEmail(email)) {
          errorMessage += '請輸入有效的電子郵件地址\n';
          isValid = false;
        }

        // 檢查密碼規則
        var hasNumber = /\d/.test(password1);
        var hasLetter = /[a-zA-Z]/.test(password1);
        var isLengthValid = password1.length >= 8;

        if (!isLengthValid || !hasNumber || !hasLetter) {
          errorMessage += '密碼需符合以下規則：\n';
          errorMessage += '- 至少 8 個字符\n';
          errorMessage += '- 至少包含一個數字\n';
          errorMessage += '- 至少包含一個字母（小寫或大寫）\n';
          isValid = false;
        }

        if (password1 !== password2) {
          errorMessage += '兩次輸入的密碼不一致，請重新輸入！\n';
          isValid = false;
        }


        if (!isValid) {
          event.preventDefault();
          alert(errorMessage);
        } 
          else {
          alert("註冊成功");
        }
      });

      function isValidEmail(email) {
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

    </script>
    
    
  </div>
{% endblock body %}